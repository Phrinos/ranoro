rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Main database document: Only authenticated users can read/write.
    match /database/{docId} {
      allow read, write: if request.auth != null;
    }

    // Public quotes: Anyone can read a single quote document. No one can write.
    match /publicQuotes/{quoteId} {
      allow get: if true;
      allow list, create, update, delete: if false;
    }

    // Public services: Anyone can read a single service.
    // Writes are only allowed to update the signature-related fields.
    match /publicServices/{serviceId} {
      allow get: if true;
      allow update: if request.resource.data.diff(resource.data).affectedKeys().hasOnly(['customerSignatureReception', 'customerSignatureDelivery', 'receptionSignatureViewed', 'deliverySignatureViewed']);
      allow list, create, delete: if false;
    }
  }
}
